<!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title>mr_routing</title>
        
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
        
        <style>
.task-list-item { list-style-type: none; } .task-list-item-checkbox { margin-left: -20px; vertical-align: middle; }
</style>
        <style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        
        
    </head>
    <body class="vscode-light">
        <h1 id="mrrouting">mr_routing</h1>
<h2 id="setup">Setup</h2>
<p>To perform this setup, you will need:</p>
<ul>
<li>A raspberry pi with an internet connection</li>
<li>A router with a 2.4GHz wireless network.</li>
<li>Some LOL1n Arduino boards, ready for programming.
There are quite a few steps. Please follow this guide carefully, it'll save time in the long run.</li>
</ul>
<h3 id="preparing-the-lol1n-boards-and-libraries">Preparing the LOL1n boards and libraries</h3>
<ul>
<li>Follow this guide <strong>carefully</strong> for each LOL1n board. Make sure the test program works. <a href="https://www.instructables.com/id/Getting-Started-With-ESP8266LiLon-NodeMCU-V3Flashi/">https://www.instructables.com/id/Getting-Started-With-ESP8266LiLon-NodeMCU-V3Flashi/</a></li>
<li>Install the library LiquidCrystal I2C <strong>by Frank de Brabander</strong>. There are multiple libraries with the same name, it's important that the correct one is installed.</li>
</ul>
<h3 id="raspberry-pi">Raspberry Pi</h3>
<ul>
<li>Install Python 3.6
<ul>
<li>To check your python version, type: <code>python -V</code>.</li>
<li>If this says 2.7, try typing <code>python3 -V</code>.</li>
<li>If this is 3.6 or higher, it's fine and you should replace <code>python3.6</code> in future commands with <code>python3</code>.</li>
<li>If not, then install python 3.6, following the guide here: <a href="http://www.knight-of-pi.org/installing-python3-6-on-a-raspberry-pi/">http://www.knight-of-pi.org/installing-python3-6-on-a-raspberry-pi/</a></li>
<li>Earlier versions may work but are not directly supported.</li>
</ul>
</li>
<li><code>sudo python3.6 -m pip install flask flask_restful</code></li>
<li>OR <code>python3.6 -m pip install --user flask flask_restful</code></li>
<li><code>git clone https://github.com/tau2pi4u/mr_routing.git</code></li>
<li><code>cd mr_routing/api</code></li>
<li><code>chmod +x api.sh</code></li>
<li>Make a file called <code>config.json</code> which contains:</li>
</ul>
<pre><code class="language-json"><div>{
    <span class="hljs-attr">"address_map"</span> : { 
        
        },
    <span class="hljs-attr">"connections"</span>:[
        
    ]
}
</div></code></pre>
<ul>
<li><code>./api.sh</code></li>
<li>If everything has worked, you should have a server running. Press CTRL+C to quit.</li>
<li>Make a note of the local ip address of your server. This can be found by typing <code>ifconfig</code></li>
</ul>
<h3 id="arduino">Arduino</h3>
<h4 id="do-this-once">Do this once:</h4>
<ul>
<li><code>cd ../</code></li>
<li>Create a file called <code>network.json</code> which contains:</li>
</ul>
<pre><code class="language-json"><div>{
    <span class="hljs-attr">"network"</span> : <span class="hljs-string">"Network Name"</span>,
    <span class="hljs-attr">"password"</span> : <span class="hljs-string">"Network Password"</span>,
    <span class="hljs-attr">"server_ip"</span> : <span class="hljs-string">"Server IP"</span>
}
</div></code></pre>
<ul>
<li>Replace <code>Network Name</code>, <code>Network Password</code> and <code>Server IP</code> with the correct values. It should look something like:</li>
</ul>
<pre><code class="language-json"><div>{
    <span class="hljs-attr">"network"</span> : <span class="hljs-string">"mr_routing"</span>,
    <span class="hljs-attr">"password"</span> : <span class="hljs-string">"model_railways"</span>,
    <span class="hljs-attr">"server_ip"</span> : <span class="hljs-string">"192.168.0.10"</span>
}
</div></code></pre>
<ul>
<li><code>cd arduino</code></li>
<li><code>python3.6 gen.py</code></li>
<li><code>cp ../gen/gen.hpp gen.hpp</code></li>
<li>Open <code>arduino.ino</code> in the arduino IDE.</li>
<li>Make sure the settings for upload are correct according to the guide from earlier.</li>
</ul>
<h4 id="do-this-for-each-arduino">Do this for each arduino</h4>
<ul>
<li>Upload the sketch to the arduino.</li>
<li>Note the mac address shown on the screen</li>
</ul>
<h3 id="updating-the-config">Updating the config</h3>
<ul>
<li>Go back to <code>config.json</code></li>
<li>In address map, add pairs of mac addresses and names. Names should be in the form <code>A#</code> where # is a number up to 4 digits.</li>
<li>This might look something like:</li>
</ul>
<pre><code class="language-json"><div><span class="hljs-string">"address_map"</span> : {
        <span class="hljs-attr">"CC:50:E3:CD:A7:47"</span> : <span class="hljs-string">"A0"</span>,
        <span class="hljs-attr">"CC:50:E3:CD:A7:52"</span> : <span class="hljs-string">"A1"</span>
        },
</div></code></pre>
<ul>
<li>Build the connections using the <code>connections</code> dictionary. These connections can either be <code>both</code>, meaning it is assumed that trains can go both ways, or <code>one-way</code>, meaning that trains can only go from the first named node to the second named node.</li>
<li>This might look something like:</li>
</ul>
<pre><code class="language-json"><div><span class="hljs-string">"connections"</span>:[
        [<span class="hljs-string">"A0"</span>, <span class="hljs-string">"A1"</span>, <span class="hljs-string">"both"</span>],
        [<span class="hljs-string">"A1"</span>, <span class="hljs-string">"A2"</span>, <span class="hljs-string">"one-way"</span>],
        [<span class="hljs-string">"A2"</span>, <span class="hljs-string">"A0"</span>, <span class="hljs-string">"one-way"</span>]
]
</div></code></pre>
<ul>
<li>Start the server by going to the <code>api</code> folder and running <code>./api.sh</code></li>
<li>The arduinos should find the server and display their configurations (wait 10 seconds for them to repeat the check).</li>
</ul>

    </body>
    </html>